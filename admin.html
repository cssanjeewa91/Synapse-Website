<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Synapse Solutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #0a0a0c;
            color: white;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .file-upload-btn {
            border: 2px dashed rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .file-upload-btn:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
    </style>
</head>

<body class="p-6 md:p-12">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-12">
            <div class="flex items-center gap-4">
                <img src="assets/img/logo.svg" alt="Logo" class="w-12 h-12 object-contain fallback-logo"
                    onerror="this.src='https://via.placeholder.com/50?text=S'">
                <h1 class="text-3xl font-bold italic uppercase tracking-tighter">Synapse <span
                        class="text-blue-500">Admin</span></h1>
            </div>
            <div class="flex gap-4">
                <button
                    onclick="if(confirm('Clear all items?')) { localStorage.removeItem('synapse_products'); location.reload(); }"
                    class="text-xs text-red-500 hover:underline px-4 py-2">Reset Inventory</button>
                <a href="index.html" class="px-6 py-2 glass rounded-xl hover:bg-white/10 transition-colors">Exit
                    Dashboard</a>
            </div>
        </div>

        <div class="grid md:grid-cols-3 gap-12">
            <!-- Form Section -->
            <div class="md:col-span-1 space-y-6">
                <div class="glass p-8 rounded-[2rem] border-blue-500/20">
                    <h2 class="text-2xl font-bold mb-6 italic">Add New Item</h2>
                    <form id="product-form" class="space-y-5">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] pl-1">Product
                                Photo</label>
                            <div class="relative group">
                                <input type="file" id="p-file" accept="image/*"
                                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                                <div class="file-upload-btn rounded-2xl p-6 text-center space-y-2">
                                    <i
                                        class="fas fa-camera text-2xl text-gray-600 group-hover:text-blue-500 transition-colors"></i>
                                    <p class="text-xs text-gray-500" id="file-label">Click / Drop Images</p>
                                </div>
                                <img id="p-preview"
                                    class="hidden w-full h-32 object-cover rounded-2xl border border-blue-500/50 mt-2">
                            </div>
                            <p class="text-[10px] text-center text-gray-600">OR enter URL below</p>
                            <input type="text" id="p-image-url" placeholder="https://..."
                                class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-bold text-gray-500 uppercase tracking-widest pl-1">Name</label>
                            <input type="text" id="p-name" required
                                class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label
                                    class="text-[10px] font-bold text-gray-500 uppercase tracking-widest pl-1">Category</label>
                                <select id="p-category"
                                    class="w-full bg-[#0a0a0c] border border-white/10 rounded-xl py-3 px-4 text-sm focus:border-blue-500 focus:outline-none">
                                    <option>Laptops</option>
                                    <option>Accessories</option>
                                    <option>PC Parts</option>
                                    <option>Audio</option>
                                    <option>Networking</option>
                                </select>
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest pl-1">Price
                                    ($)</label>
                                <input type="number" id="p-price" required
                                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>

                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-bold text-gray-500 uppercase tracking-widest pl-1">Description</label>
                            <textarea id="p-desc" rows="3" placeholder="Key specs and details..."
                                class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm focus:border-blue-500 focus:outline-none"></textarea>
                        </div>

                        <button type="submit"
                            class="w-full py-4 bg-blue-600 hover:bg-blue-700 rounded-2xl font-bold uppercase tracking-widest text-xs transition-all shadow-xl shadow-blue-600/20 active:scale-95">Add
                            to Stock</button>
                    </form>
                </div>
            </div>

            <!-- List Section -->
            <div class="md:col-span-2">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold italic">Stock <span class="text-blue-500">List</span></h2>
                    <div id="stock-count"
                        class="px-4 py-1 glass rounded-full text-[10px] uppercase font-bold text-blue-400 border-blue-500/20">
                        0 Items</div>
                </div>
                <div id="admin-items-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Items injected here -->
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        let currentFileData = "";

        // Handle File Selection
        document.getElementById('p-file').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    currentFileData = event.target.result;
                    document.getElementById('p-preview').src = currentFileData;
                    document.getElementById('p-preview').classList.remove('hidden');
                    document.getElementById('file-label').innerText = file.name;
                };
                reader.readAsDataURL(file);
            }
        });

        const renderAdminList = () => {
            const container = document.getElementById('admin-items-container');
            const products = ProductManager.getProducts();
            document.getElementById('stock-count').innerText = `${products.length} Items`;

            if (products.length === 0) {
                container.innerHTML = '<div class="col-span-full py-20 text-center glass rounded-3xl text-gray-600 italic">No items in inventory.</div>';
                return;
            }

            container.innerHTML = products.map(p => `
                <div class="glass p-4 rounded-3xl flex flex-col gap-4 group hover:border-blue-500/30 transition-all">
                    <div class="relative h-40 rounded-2xl overflow-hidden">
                        <img src="${p.image || 'https://via.placeholder.com/200'}" class="w-full h-full object-cover">
                        <div class="absolute top-2 right-2 flex gap-2">
                            <button onclick="handleDelete(${p.id})" class="w-8 h-8 rounded-lg bg-black/60 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center backdrop-blur-md">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold text-lg">${p.name}</h3>
                                <p class="text-[10px] text-blue-500 font-bold uppercase tracking-wider">${p.category}</p>
                            </div>
                            <p class="font-mono text-xl font-bold text-green-400">$${p.price}</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 line-clamp-2">${p.desc || 'No description'}</p>
                    </div>
                </div>
            `).sort((a, b) => b.id - a.id).join('');
        };

        const handleDelete = (id) => {
            if (confirm('Permanently remove this item from stock?')) {
                ProductManager.deleteProduct(id);
                renderAdminList();
            }
        };

        document.getElementById('product-form').addEventListener('submit', (e) => {
            e.preventDefault();

            // Priority: File Upload > URL Input
            let finalImage = currentFileData || document.getElementById('p-image-url').value;

            const product = {
                name: document.getElementById('p-name').value,
                category: document.getElementById('p-category').value,
                price: document.getElementById('p-price').value,
                image: finalImage,
                desc: document.getElementById('p-desc').value
            };

            ProductManager.saveProduct(product);

            // Clean up
            e.target.reset();
            currentFileData = "";
            document.getElementById('p-preview').classList.add('hidden');
            document.getElementById('file-label').innerText = "Click / Drop Images";

            renderAdminList();
            alert('Item successfully synchronized to the store!');
        });

        window.onload = renderAdminList;
    </script>
</body>

</html>